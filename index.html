<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zhalker Coin Clicker - Roblox 2008</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #6b8cff, #3a5fcd);
            background-attachment: fixed;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            overflow-x: hidden;
        }
        
        .container {
            width: 100%;
            max-width: 800px;
            background: rgba(255, 255, 255, 0.8);
            border: 8px solid #000;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
            text-align: center;
        }
        
        .header {
            margin-bottom: 30px;
        }
        
        h1 {
            font-family: 'Impact', 'Arial Black', sans-serif;
            font-size: 48px;
            color: #fff;
            text-shadow: 4px 4px 0 #000, 6px 6px 0 rgba(0, 0, 0, 0.3);
            margin-bottom: 10px;
            letter-spacing: 1px;
            text-transform: uppercase;
        }
        
        .subtitle {
            font-size: 20px;
            color: #ffcc00;
            text-shadow: 2px 2px 0 #000;
            margin-bottom: 30px;
            font-weight: bold;
        }
        
        .tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .tab {
            background: linear-gradient(to bottom, #555, #333);
            border: 4px solid #000;
            border-radius: 8px;
            padding: 10px 20px;
            cursor: pointer;
            font-weight: bold;
            font-size: 18px;
            color: #ffcc00;
            text-shadow: 1px 1px 0 #000;
            transition: all 0.2s;
        }
        
        .tab.active {
            background: linear-gradient(to bottom, #ff9900, #cc6600);
            box-shadow: 0 0 15px rgba(255, 153, 0, 0.7);
        }
        
        .tab:hover {
            transform: translateY(-3px);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .coin-display {
            background: linear-gradient(to bottom, #ffcc00, #ff9900);
            border: 6px solid #000;
            border-radius: 50%;
            width: 200px;
            height: 200px;
            margin: 0 auto 30px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
            box-shadow: 0 8px 0 #cc9900, inset 0 0 20px rgba(255, 204, 0, 0.8);
        }
        
        .coin-value {
            font-family: 'Courier New', monospace;
            font-size: 46px;
            font-weight: bold;
            color: #fff;
            text-shadow: 3px 3px 0 #000, 5px 5px 0 rgba(0, 0, 0, 0.3);
            margin-bottom: 10px;
        }
        
        .coin-label {
            font-family: 'Arial Black', sans-serif;
            font-size: 24px;
            color: #fff;
            text-shadow: 2px 2px 0 #000;
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        
        .click-area {
            background: linear-gradient(to bottom, #ff6600, #cc3300);
            border: 6px solid #000;
            border-radius: 15px;
            padding: 40px;
            margin: 20px auto 30px;
            cursor: pointer;
            transition: all 0.1s;
            box-shadow: 0 10px 0 #993300, inset 0 0 15px rgba(255, 102, 0, 0.5);
            max-width: 400px;
        }
        
        .click-area:active {
            transform: translateY(5px);
            box-shadow: 0 5px 0 #993300;
        }
        
        .click-area h2 {
            font-family: 'Comic Sans MS', cursive;
            font-size: 36px;
            color: #fff;
            text-shadow: 3px 3px 0 #000;
        }
        
        .upgrades {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin-top: 30px;
        }
        
        .upgrade {
            background: linear-gradient(to bottom, #33cc33, #009900);
            border: 4px solid #000;
            border-radius: 10px;
            padding: 15px;
            width: 180px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .upgrade:hover {
            transform: translateY(-3px);
        }
        
        .upgrade:active {
            transform: translateY(2px);
        }
        
        .upgrade h3 {
            font-family: 'Arial Black', sans-serif;
            font-size: 18px;
            color: #fff;
            text-shadow: 2px 2px 0 #000;
            margin-bottom: 8px;
        }
        
        .upgrade p {
            font-size: 14px;
            color: #fff;
            text-shadow: 1px 1px 0 #000;
            margin-bottom: 5px;
        }
        
        .upgrade-cost {
            font-weight: bold;
            color: #ffcc00;
            text-shadow: 1px 1px 0 #000;
        }
        
        .stats {
            margin-top: 30px;
            background: rgba(0, 0, 0, 0.2);
            border: 4px solid #000;
            border-radius: 10px;
            padding: 15px;
        }
        
        .stats p {
            font-size: 18px;
            color: #fff;
            text-shadow: 1px 1px 0 #000;
            margin: 8px 0;
            font-weight: bold;
        }
        
        .save-section {
            margin-top: 25px;
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .save-button {
            background: linear-gradient(to bottom, #4d79ff, #1a53ff);
            border: 4px solid #000;
            border-radius: 10px;
            padding: 12px 20px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.2s;
            text-shadow: 1px 1px 0 #000;
            box-shadow: 0 5px 0 #0039e6;
        }
        
        .save-button:hover {
            transform: translateY(-3px);
        }
        
        .save-button:active {
            transform: translateY(2px);
            box-shadow: 0 2px 0 #0039e6;
        }
        
        .save-input {
            background: rgba(255, 255, 255, 0.9);
            border: 4px solid #000;
            border-radius: 10px;
            padding: 10px;
            width: 100%;
            max-width: 500px;
            margin-top: 15px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
        
        .save-timer {
            margin-top: 10px;
            font-size: 14px;
            color: #ffcc00;
            text-shadow: 1px 1px 0 #000;
            font-weight: bold;
        }
        
        .class-shop {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 20px;
        }
        
        .class-item {
            background: linear-gradient(to bottom, #7a5ada, #4d3a9e);
            border: 5px solid #000;
            border-radius: 12px;
            padding: 20px;
            width: 300px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: left;
        }
        
        .class-item:hover {
            transform: translateY(-5px);
        }
        
        .class-item h3 {
            font-size: 24px;
            color: #ffcc00;
            text-shadow: 2px 2px 0 #000;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .class-item ul {
            margin: 15px 0;
            padding-left: 20px;
        }
        
        .class-item li {
            margin-bottom: 8px;
            font-size: 16px;
        }
        
        .class-cost {
            font-weight: bold;
            color: #ffcc00;
            text-align: center;
            font-size: 20px;
            margin-top: 10px;
        }
        
        .arena {
            margin-top: 20px;
            background: rgba(0, 0, 0, 0.3);
            border: 6px solid #000;
            border-radius: 15px;
            padding: 20px;
            position: relative;
            min-height: 300px;
            overflow: hidden;
        }
        
        .arena-title {
            font-size: 28px;
            color: #ff6600;
            text-shadow: 2px 2px 0 #000;
            margin-bottom: 20px;
        }
        
        .combatants {
            display: flex;
            justify-content: space-around;
            align-items: center;
            margin-bottom: 30px;
        }
        
        .player, .bot {
            text-align: center;
            width: 200px;
        }
        
        .character {
            width: 120px;
            height: 120px;
            background: #555;
            border: 5px solid #000;
            border-radius: 10px;
            margin: 0 auto 15px;
            position: relative;
            overflow: hidden;
        }
        
        .player .character {
            background: linear-gradient(to bottom, #55aaff, #2266cc);
        }
        
        .bot .character {
            background: linear-gradient(to bottom, #ff5555, #cc2222);
        }
        
        .health-bar {
            width: 100%;
            height: 20px;
            background: #333;
            border: 2px solid #000;
            border-radius: 5px;
            margin-top: 10px;
            overflow: hidden;
        }
        
        .health-fill {
            height: 100%;
            background: linear-gradient(to right, #00cc00, #00aa00);
            transition: width 0.3s;
        }
        
        .bot .health-fill {
            background: linear-gradient(to right, #cc0000, #aa0000);
        }
        
        .skills {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 20px;
        }
        
        .skill {
            background: linear-gradient(to bottom, #5555ff, #3333aa);
            border: 4px solid #000;
            border-radius: 8px;
            padding: 12px 15px;
            cursor: pointer;
            transition: all 0.2s;
            width: 180px;
        }
        
        .skill:hover {
            transform: translateY(-3px);
        }
        
        .skill:active {
            transform: translateY(1px);
        }
        
        .skill h4 {
            font-size: 18px;
            margin-bottom: 8px;
            color: #ffcc00;
            text-shadow: 1px 1px 0 #000;
        }
        
        .skill p {
            font-size: 14px;
        }
        
        .cooldown {
            color: #ff9900;
            font-weight: bold;
            margin-top: 5px;
        }
        
        .combat-log {
            margin-top: 20px;
            background: rgba(0, 0, 0, 0.5);
            border: 3px solid #000;
            border-radius: 8px;
            padding: 10px;
            height: 100px;
            overflow-y: auto;
            text-align: left;
            font-size: 14px;
        }
        
        .log-entry {
            margin-bottom: 5px;
            padding: 3px;
            border-radius: 3px;
        }
        
        .player-log {
            background: rgba(85, 170, 255, 0.2);
            color: #55aaff;
        }
        
        .bot-log {
            background: rgba(255, 85, 85, 0.2);
            color: #ff5555;
        }
        
        .promo-section {
            margin-top: 20px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border: 4px solid #ffcc00;
            border-radius: 10px;
        }
        
        .promo-input-group {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 10px;
        }
        
        .promo-input {
            background: rgba(255, 255, 255, 0.9);
            border: 4px solid #000;
            border-radius: 8px;
            padding: 10px;
            font-size: 16px;
            width: 200px;
            text-align: center;
        }
        
        .promo-button {
            background: linear-gradient(to bottom, #ff9900, #cc6600);
            border: 4px solid #000;
            border-radius: 8px;
            padding: 10px 15px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            font-size: 16px;
        }
        
        .promo-message {
            margin-top: 10px;
            font-size: 16px;
            min-height: 25px;
            font-weight: bold;
            color: #ffcc00;
            text-shadow: 1px 1px 0 #000;
        }
        
        .footer {
            margin-top: 30px;
            color: #fff;
            text-shadow: 1px 1px 0 #000;
            font-size: 14px;
        }
        
        /* Роблокс-стиль эффектов */
        .coin-effect {
            position: absolute;
            font-family: 'Arial Black', sans-serif;
            font-size: 24px;
            color: #ffcc00;
            text-shadow: 2px 2px 0 #000;
            animation: floatUp 1.5s ease-out forwards;
            pointer-events: none;
            z-index: 10;
        }
        
        @keyframes floatUp {
            0% {
                opacity: 1;
                transform: translateY(0);
            }
            100% {
                opacity: 0;
                transform: translateY(-100px);
            }
        }
        
        /* Лидерборд */
        .leaderboard {
            margin-top: 20px;
            background: rgba(0, 0, 0, 0.3);
            border: 4px solid #ffcc00;
            border-radius: 10px;
            padding: 15px;
            display: none;
        }
        
        .leaderboard-title {
            font-size: 24px;
            color: #ffcc00;
            text-shadow: 2px 2px 0 #000;
            margin-bottom: 15px;
        }
        
        .leaderboard-list {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .leaderboard-item {
            display: flex;
            justify-content: space-between;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid #000;
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 8px;
            font-size: 16px;
        }
        
        .leaderboard-name {
            font-weight: bold;
            color: #55aaff;
        }
        
        .leaderboard-score {
            font-weight: bold;
            color: #ffcc00;
        }
        
        .player-highlight {
            background: rgba(255, 215, 0, 0.3);
            border: 2px solid #ffcc00;
        }
        
        /* Инвентарь */
        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .inventory-item {
            background: linear-gradient(to bottom, #8a6dff, #5a4dcc);
            border: 4px solid #000;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .inventory-item.active {
            background: linear-gradient(to bottom, #ffcc00, #cc9900);
            box-shadow: 0 0 15px rgba(255, 204, 0, 0.7);
        }
        
        .inventory-item:hover {
            transform: translateY(-3px);
        }
        
        .inventory-item h4 {
            font-size: 16px;
            color: #fff;
            text-shadow: 1px 1px 0 #000;
            margin-bottom: 5px;
        }
        
        .inventory-item p {
            font-size: 12px;
            color: #ffcc00;
        }
        
        .bottle-item {
            background: linear-gradient(to bottom, #00cc99, #009966);
        }
        
        .gravity-item {
            background: linear-gradient(to bottom, #5a5aff, #3a3acc);
        }
        
        .glitch-item {
            background: linear-gradient(to bottom, #cc55ff, #9933cc);
        }
        
        /* Секретный класс */
        .bomber-class {
            background: linear-gradient(to bottom, #ff5500, #cc3300);
            border: 5px solid #000;
        }
        
        /* Новый класс для Пистолетчика */
        .pistol-item {
            background: linear-gradient(to bottom, #5a7aff, #3a5acd);
        }
        
        /* Новый класс для Билдера */
        .builder-item {
            background: linear-gradient(to bottom, #cd853f, #8b4513);
        }
        
        /* Адаптивность */
        @media (max-width: 600px) {
            h1 {
                font-size: 36px;
            }
            
            .click-area {
                padding: 25px;
            }
            
            .upgrade, .class-item {
                width: 100%;
                max-width: 250px;
            }
            
            .combatants {
                flex-direction: column;
                gap: 30px;
            }
            
            .tabs {
                flex-direction: column;
                align-items: center;
            }
            
            .tab {
                width: 100%;
                max-width: 200px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Zhalker Coin Clicker</h1>
            <div class="subtitle">Roblox 2008 Style - Глобальный лидерборд!</div>
            
            <div class="tabs">
                <div class="tab active" data-tab="clicker">Кликер</div>
                <div class="tab" data-tab="classes">Классы</div>
                <div class="tab" data-tab="inventory">Инвентарь</div>
                <div class="tab" data-tab="arena">Арена</div>
                <div class="tab" data-tab="leaderboard">Лидерборд</div>
            </div>
        </div>
        
        <!-- Вкладка кликера -->
        <div class="tab-content active" id="clicker-tab">
            <div class="coin-display">
                <div class="coin-value" id="coin-count">0</div>
                <div class="coin-label">Zhalker Coins</div>
            </div>
            
            <div class="click-area" id="clicker">
                <h2>НАЖМИ МЕНЯ!</h2>
            </div>
            
            <div class="upgrades">
                <div class="upgrade" id="upgrade1">
                    <h3>Клик Усилитель</h3>
                    <p>+1 монета за клик</p>
                    <p class="upgrade-cost">Стоимость: 10 ZC</p>
                </div>
                <div class="upgrade" id="upgrade2">
                    <h3>Авто-Кликер</h3>
                    <p>+1 монета в секунду</p>
                    <p class="upgrade-cost">Стоимость: 50 ZC</p>
                </div>
                <div class="upgrade" id="upgrade3">
                    <h3>Мега Усилитель</h3>
                    <p>+5 монет за клик</p>
                    <p class="upgrade-cost">Стоимость: 200 ZC</p>
                </div>
                <div class="upgrade" id="bottle-upgrade">
                    <h3>Бутылка 2.2X</h3>
                    <p>Ускорение на 30 сек</p>
                    <p class="upgrade-cost">Стоимость: 100 ZC</p>
                </div>
            </div>
            
            <div class="stats">
                <p>Монет за клик: <span id="coins-per-click">1</span></p>
                <p>Монет в секунду: <span id="coins-per-second">0</span></p>
                <p>Улучшений куплено: <span id="upgrades-count">0</span></p>
                <p>Активный класс: <span id="current-class">Отсутствует</span></p>
                <p>Бутылка 2.2X: <span id="bottle-timer">Не активна</span></p>
                <p>Ваш ID: <span id="player-id">Загрузка...</span></p>
            </div>
        </div>
        
        <!-- Вкладка классов -->
        <div class="tab-content" id="classes-tab">
            <h2 style="color: #ffcc00; margin-bottom: 20px; text-shadow: 2px 2px 0 #000;">Магазин Классов</h2>
            
            <div class="class-shop">
                <div class="class-item" id="noob-class">
                    <h3>Нуб</h3>
                    <p>Начинающий боец с простыми, но эффективными способностями</p>
                    <ul>
                        <li>Бутылка здоровья: восстанавливает здоровье (перезарядка 5.6 сек)</li>
                        <li>Летающий бургер: замораживает врага и наносит 15 урона (4.59 сек)</li>
                        <li>Меч: наносит 25 урона и парирует атаки</li>
                    </ul>
                    <div class="class-cost">Цена: 500 ZC</div>
                </div>
                
                <div class="class-item" id="shed-class">
                    <h3>Шедлеский</h3>
                    <p>Мастер клинка с быстрыми атаками и поддержкой</p>
                    <ul>
                        <li>Меч: наносит 15-23 урона (перезарудка 1.99 сек)</li>
                        <li>Курочка: лечит 19-29 здоровья</li>
                    </ul>
                    <div class="class-cost">Цена: 800 ZC</div>
                </div>
                
                <div class="class-item builder-item" id="builder-class">
                    <h3>Билдер</h3>
                    <p>Строитель укреплений и мастер турелей</p>
                    <ul>
                        <li>Турель: 15-27 урона каждые 5.6 сек</li>
                        <li>Большой молоток: 34 урона + парирование (13 сек)</li>
                        <li>Удар ногой: 50 урона (20 сек)</li>
                    </ul>
                    <div class="class-cost">Цена: 150 ZC</div>
                </div>
                
                <!-- Секретный класс Bomber -->
                <div class="class-item bomber-class" id="bomber-class">
                    <h3>BOMBER (Секретный)</h3>
                    <p>Мастер взрывчатки с разрушительными способностями</p>
                    <ul>
                        <li>Летающий взрыв: запускает бомбы (3-4.4 урона каждая)</li>
                        <li>Гравитационная бомба: притягивает врагов и наносит 15 урона</li>
                        <li>Глючная мина: вызывает сбои у противника (перезарядка 10 сек)</li>
                    </ul>
                    <div class="class-cost">Только через промокод</div>
                </div>
                
                <!-- Секретный класс Пистолетчик -->
                <div class="class-item pistol-item" id="pistol-class">
                    <h3>Пистолетчик (Секретный)</h3>
                    <p>Мастер огнестрельного оружия с уникальными способностями</p>
                    <ul>
                        <li>Джэкпот: шанс 15% на усиление урона на 15%</li>
                        <li>Пистолет: 20-34 урона (шанс 15% на +-15% урона)</li>
                        <li>Шляпа: защищает пистолет от потери (требует джэкпота)</li>
                    </ul>
                    <div class="class-cost">Только через промокод</div>
                </div>
            </div>
        </div>
        
        <!-- Вкладка инвентаря -->
        <div class="tab-content" id="inventory-tab">
            <h2 style="color: #ffcc00; margin-bottom: 20px; text-shadow: 2px 2px 0 #000;">Ваш Инвентарь</h2>
            
            <div class="inventory-grid" id="inventory-grid">
                <!-- Классы и бутылки будут добавляться сюда динамически -->
            </div>
        </div>
        
        <!-- Вкладка арены -->
        <div class="tab-content" id="arena-tab">
            <h2 class="arena-title">Арена Боя</h2>
            
            <div class="arena">
                <div class="combatants">
                    <div class="player">
                        <h3>Игрок</h3>
                        <div class="character">
                            <div class="class-icon" id="player-class">Нет</div>
                        </div>
                        <div class="health-bar">
                            <div class="health-fill" id="player-health" style="width: 100%"></div>
                        </div>
                        <div>Здоровье: <span id="player-health-text">100</span>/100</div>
                    </div>
                    
                    <div class="bot">
                        <h3>Бот</h3>
                        <div class="character">
                            <div class="class-icon">Тролль</div>
                        </div>
                        <div class="health-bar">
                            <div class="health-fill" id="bot-health" style="width: 100%"></div>
                        </div>
                        <div>Здоровье: <span id="bot-health-text">100</span>/100</div>
                    </div>
                </div>
                
                <div class="skills">
                    <div class="skill" id="skill1">
                        <h4>Навык 1</h4>
                        <p>Описание навыка</p>
                        <div class="cooldown">Готово</div>
                    </div>
                    <div class="skill" id="skill2">
                        <h4>Навык 2</h4>
                        <p>Описание навыка</p>
                        <div class="cooldown">Готово</div>
                    </div>
                    <div class="skill" id="skill3">
                        <h4>Навык 3</h4>
                        <p>Описание навыка</p>
                        <div class="cooldown">Готово</div>
                    </div>
                    <div class="skill" id="attack">
                        <h4>Атаковать</h4>
                        <p>Обычная атака (10 урона)</p>
                    </div>
                </div>
                
                <div class="combat-log" id="combat-log">
                    <div class="log-entry">Бой начался! Выберите действие.</div>
                </div>
            </div>
        </div>
        
        <!-- Вкладка лидерборда -->
        <div class="tab-content" id="leaderboard-tab">
            <h2 style="color: #ffcc00; margin-bottom: 20px; text-shadow: 2px 2px 0 #000;">Глобальный Лидерборд</h2>
            
            <div class="leaderboard">
                <div class="leaderboard-title">Топ игроков</div>
                <div class="leaderboard-list" id="leaderboard-list">
                    <div class="leaderboard-item">
                        <span class="leaderboard-name">Загрузка...</span>
                        <span class="leaderboard-score">0</span>
                    </div>
                </div>
            </div>
            
            <div class="stats" style="margin-top: 20px;">
                <p>Ваше место: <span id="player-rank">Загрузка...</span></p>
                <p>Ваши монеты: <span id="player-score">0</span></p>
            </div>
        </div>
        
        <div class="save-section">
            <button class="save-button" id="save-game">Создать сохранение</button>
            <button class="save-button" id="load-game">Использовать сохранение</button>
        </div>
        
        <input type="text" id="save-link" class="save-input" placeholder="Ссылка сохранения появится здесь..." readonly>
        <div class="save-timer" id="save-timer"></div>
        
        <div class="promo-section">
            <h3>Активируйте Промокоды</h3>
            <div class="promo-input-group">
                <input type="text" id="promo-code" class="promo-input" placeholder="Введите промокод..." maxlength="20">
                <button class="promo-button" id="activate-promo">Активировать</button>
            </div>
            <div class="promo-message" id="promo-message"></div>
        </div>
        
        <div class="footer">
            Zhalker Coin Clicker &copy; 2008 | Roblox Style | Глобальный лидерборд
        </div>
    </div>
    
    <script>
        // Игровые переменные
        let coins = 0;
        let coinsPerClick = 1;
        let coinsPerSecond = 0;
        let upgrades = {
            upgrade1: 0,
            upgrade2: 0,
            upgrade3: 0,
            bottleUpgrade: 0
        };
        let playerClass = null;
        let playerId = null;
        let activatedPromos = [];
        let inventory = {
            classes: [],
            bottles: 0,
            gravityBottles: 0,
            glitchBottles: 0
        };
        let bottleActive = false;
        let bottleTimer = 0;
        
        // Переменные арены
        let playerHealth = 100;
        let botHealth = 100;
        let botFrozen = false;
        let botFrozenTimer = null;
        let parryActive = false;
        let skillCooldowns = {
            skill1: 0,
            skill2: 0,
            skill3: 0
        };
        
        // Переменные для новых классов
        let hatActive = false;
        let hatTimer = null;
        let turretInterval = null;
        let parryTimer = null;
        
        // Переменные для сохранений
        let saveTimeout = null;
        let saveExpiryTime = null;
        
        // Элементы интерфейса
        const coinCountElement = document.getElementById('coin-count');
        const coinsPerClickElement = document.getElementById('coins-per-click');
        const coinsPerSecondElement = document.getElementById('coins-per-second');
        const upgradesCountElement = document.getElementById('upgrades-count');
        const currentClassElement = document.getElementById('current-class');
        const bottleTimerElement = document.getElementById('bottle-timer');
        const playerIdElement = document.getElementById('player-id');
        const clicker = document.getElementById('clicker');
        const coinDisplay = document.querySelector('.coin-display');
        const saveLinkInput = document.getElementById('save-link');
        const saveTimerElement = document.getElementById('save-timer');
        const saveGameButton = document.getElementById('save-game');
        const loadGameButton = document.getElementById('load-game');
        const noobClass = document.getElementById('noob-class');
        const shedClass = document.getElementById('shed-class');
        const builderClass = document.getElementById('builder-class');
        const bomberClass = document.getElementById('bomber-class');
        const pistolClass = document.getElementById('pistol-class');
        const playerClassIcon = document.getElementById('player-class');
        const playerHealthElement = document.getElementById('player-health');
        const playerHealthText = document.getElementById('player-health-text');
        const botHealthElement = document.getElementById('bot-health');
        const botHealthText = document.getElementById('bot-health-text');
        const combatLog = document.getElementById('combat-log');
        const attackButton = document.getElementById('attack');
        const skill1Button = document.getElementById('skill1');
        const skill2Button = document.getElementById('skill2');
        const skill3Button = document.getElementById('skill3');
        const promoInput = document.getElementById('promo-code');
        const activatePromoButton = document.getElementById('activate-promo');
        const promoMessage = document.getElementById('promo-message');
        const inventoryGrid = document.getElementById('inventory-grid');
        const bottleUpgrade = document.getElementById('bottle-upgrade');
        const leaderboardList = document.getElementById('leaderboard-list');
        const playerRankElement = document.getElementById('player-rank');
        const playerScoreElement = document.getElementById('player-score');
        
        // Элементы вкладок
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');
        
        // Инициализация игры
        function initGame() {
            // Генерация уникального ID игрока
            playerId = localStorage.getItem('zhalkerPlayerId');
            if (!playerId) {
                playerId = 'player_' + Math.random().toString(36).substr(2, 9);
                localStorage.setItem('zhalkerPlayerId', playerId);
            }
            playerIdElement.textContent = playerId;
            
            // Проверка наличия сохранения в URL
            const urlParams = new URLSearchParams(window.location.search);
            const saveData = urlParams.get('save');
            
            if (saveData) {
                try {
                    loadSaveFromData(saveData);
                } catch (error) {
                    console.error('Ошибка загрузки сохранения из URL:', error);
                }
            } else {
                // Загрузка локального сохранения
                loadLocalSave();
            }
            
            // Обновление интерфейса
            updateUI();
            updateSkillsForClass();
            updateInventory();
            
            // Сохранение игры каждые 30 секунд
            setInterval(saveGame, 30000);
            
            // Автоматическое начисление монет
            setInterval(() => {
                const multiplier = bottleActive ? 2.2 : 1;
                coins += Math.floor(coinsPerSecond * multiplier);
                updateUI();
                saveGame();
            }, 1000);
            
            // Обновление перезарядки навыков
            setInterval(() => {
                let updated = false;
                
                for (const skill in skillCooldowns) {
                    if (skillCooldowns[skill] > 0) {
                        skillCooldowns[skill] = Math.max(0, skillCooldowns[skill] - 0.1);
                        updated = true;
                    }
                }
                
                if (updated) updateSkillCooldowns();
                
                // Обновление таймера бутылки
                if (bottleActive) {
                    bottleTimer -= 0.1;
                    if (bottleTimer <= 0) {
                        bottleActive = false;
                        addLogEntry("Эффект бутылки 2.2X закончился!", "player");
                    }
                    updateUI();
                }
                
                // Обновление таймера сохранения
                updateSaveTimer();
            }, 100);
        }
        
        // Обновление таймера сохранения
        function updateSaveTimer() {
            if (saveExpiryTime) {
                const timeLeft = Math.max(0, Math.ceil((saveExpiryTime - Date.now()) / 1000));
                
                if (timeLeft > 0) {
                    saveTimerElement.textContent = `Ссылка действительна еще: ${timeLeft} сек`;
                    saveTimerElement.style.color = timeLeft > 5 ? "#00ff00" : "#ff0000";
                } else {
                    saveTimerElement.textContent = "Ссылка больше не действительна!";
                    saveTimerElement.style.color = "#ff0000";
                    saveLinkInput.value = "";
                    clearTimeout(saveTimeout);
                    saveExpiryTime = null;
                }
            }
        }
        
        // Переключение вкладок
        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const tabId = tab.getAttribute('data-tab');
                
                // Деактивируем все вкладки
                tabs.forEach(t => t.classList.remove('active'));
                tabContents.forEach(c => c.classList.remove('active'));
                
                // Активируем выбранную вкладку
                tab.classList.add('active');
                document.getElementById(`${tabId}-tab`).classList.add('active');
                
                // Обновляем навыки на арене
                updateSkillsForClass();
                
                // Обновляем инвентарь при переходе на вкладку
                if (tabId === 'inventory') {
                    updateInventory();
                }
            });
        });
        
        // Обновление интерфейса
        function updateUI() {
            coinCountElement.textContent = coins.toLocaleString();
            coinsPerClickElement.textContent = coinsPerClick;
            coinsPerSecondElement.textContent = coinsPerSecond;
            
            // Подсчет общего количества улучшений
            const totalUpgrades = upgrades.upgrade1 + upgrades.upgrade2 + upgrades.upgrade3;
            upgradesCountElement.textContent = totalUpgrades;
            
            // Обновление информации о классе
            currentClassElement.textContent = playerClass || "Отсутствует";
            currentClassElement.style.color = playerClass ? "#55ff55" : "#ff5555";
            playerClassIcon.textContent = playerClass || "Нет";
            
            // Обновление здоровья на арене
            playerHealthElement.style.width = `${playerHealth}%`;
            playerHealthText.textContent = playerHealth;
            botHealthElement.style.width = `${botHealth}%`;
            botHealthText.textContent = botHealth;
            
            // Обновление таймера бутылки
            if (bottleActive) {
                bottleTimerElement.textContent = `Активна: ${bottleTimer.toFixed(1)} сек`;
                bottleTimerElement.style.color = "#00ff00";
            } else {
                bottleTimerElement.textContent = "Не активна";
                bottleTimerElement.style.color = "#ff5555";
            }
        }
        
        // Обновление инвентаря
        function updateInventory() {
            inventoryGrid.innerHTML = '';
            
            // Добавляем классы
            inventory.classes.forEach(cls => {
                const item = document.createElement('div');
                item.className = `inventory-item ${playerClass === cls ? 'active' : ''}`;
                item.innerHTML = `
                    <h4>${cls}</h4>
                    <p>Класс</p>
                `;
                item.addEventListener('click', () => {
                    playerClass = cls;
                    updateUI();
                    updateSkillsForClass();
                    updateInventory();
                    addLogEntry(`Вы выбрали класс ${cls}`, "player");
                });
                inventoryGrid.appendChild(item);
            });
            
            // Бутылка 2.2X
            if (inventory.bottles > 0) {
                const item = document.createElement('div');
                item.className = 'inventory-item bottle-item';
                item.innerHTML = `
                    <h4>Бутылка 2.2X</h4>
                    <p>Осталось: ${inventory.bottles}</p>
                `;
                item.addEventListener('click', activateBottle);
                inventoryGrid.appendChild(item);
            }
            
            // Бутылка гравитации
            if (inventory.gravityBottles > 0) {
                const item = document.createElement('div');
                item.className = 'inventory-item gravity-item';
                item.innerHTML = `
                    <h4>Бутылка гравитации</h4>
                    <p>Осталось: ${inventory.gravityBottles}</p>
                `;
                item.addEventListener('click', activateGravityBottle);
                inventoryGrid.appendChild(item);
            }
            
            // Бутылка глюцинации
            if (inventory.glitchBottles > 0) {
                const item = document.createElement('div');
                item.className = 'inventory-item glitch-item';
                item.innerHTML = `
                    <h4>Бутылка глюцинации</h4>
                    <p>Осталось: ${inventory.glitchBottles}</p>
                `;
                item.addEventListener('click', activateGlitchBottle);
                inventoryGrid.appendChild(item);
            }
        }
        
        // Обновление навыков на арене
        function updateSkillsForClass() {
            if (!playerClass) {
                skill1Button.style.display = 'none';
                skill2Button.style.display = 'none';
                skill3Button.style.display = 'none';
                return;
            }
            
            if (playerClass === "Нуб") {
                skill1Button.style.display = 'block';
                skill2Button.style.display = 'block';
                skill3Button.style.display = 'block';
                
                skill1Button.querySelector('h4').textContent = "Бутылка здоровья";
                skill1Button.querySelector('p').textContent = "Восстанавливает 30 здоровья";
                skill1Button.querySelector('.cooldown').textContent = "Перезарядка: 5.6 сек";
                
                skill2Button.querySelector('h4').textContent = "Летающий бургер";
                skill2Button.querySelector('p').textContent = "Наносит 15 урона и замораживает";
                skill2Button.querySelector('.cooldown').textContent = "Перезарядка: 4.59 сек";
                
                skill3Button.querySelector('h4').textContent = "Меч";
                skill3Button.querySelector('p').textContent = "Наносит 25 урона и парирует";
                skill3Button.querySelector('.cooldown').textContent = "Перезарядка: 3 сек";
            } 
            else if (playerClass === "Шедлеский") {
                skill1Button.style.display = 'block';
                skill2Button.style.display = 'block';
                skill3Button.style.display = 'none';
                
                skill1Button.querySelector('h4').textContent = "Меч";
                skill1Button.querySelector('p').textContent = "Наносит 15-23 урона";
                skill1Button.querySelector('.cooldown').textContent = "Перезарядка: 1.99 сек";
                
                skill2Button.querySelector('h4').textContent = "Курочка";
                skill2Button.querySelector('p').textContent = "Лечит 19-29 HP";
                skill2Button.querySelector('.cooldown').textContent = "Перезарядка: 4 сек";
            }
            else if (playerClass === "Bomber") {
                skill1Button.style.display = 'block';
                skill2Button.style.display = 'block';
                skill3Button.style.display = 'block';
                
                skill1Button.querySelector('h4').textContent = "Летающий взрыв";
                skill1Button.querySelector('p').textContent = "Запускает 5 бомб (3-4.4 урона)";
                skill1Button.querySelector('.cooldown').textContent = "Перезарядка: 10 сек";
                
                skill2Button.querySelector('h4').textContent = "Гравитационная бомба";
                skill2Button.querySelector('p').textContent = "Притягивает врагов (15 урона)";
                skill2Button.querySelector('.cooldown').textContent = "Перезарядка: 8 сек";
                
                skill3Button.querySelector('h4').textContent = "Глючная мина";
                skill3Button.querySelector('p').textContent = "Вызывает сбои у противника";
                skill3Button.querySelector('.cooldown').textContent = "Перезарядка: 12 сек";
            }
            else if (playerClass === "Пистолетчик") {
                skill1Button.style.display = 'block';
                skill2Button.style.display = 'block';
                skill3Button.style.display = 'none';
                
                skill1Button.querySelector('h4').textContent = "Пистолет";
                skill1Button.querySelector('p').textContent = "20-34 урона (15% шанс +-15%)";
                skill1Button.querySelector('.cooldown').textContent = "Перезарядка: 4 сек";
                
                skill2Button.querySelector('h4').textContent = "Шляпа";
                skill2Button.querySelector('p').textContent = "Защищает пистолет от потери";
                skill2Button.querySelector('.cooldown').textContent = "Перезарядка: 15 сек";
            }
            else if (playerClass === "Билдер") {
                skill1Button.style.display = 'block';
                skill2Button.style.display = 'block';
                skill3Button.style.display = 'block';
                
                skill1Button.querySelector('h4').textContent = "Турель";
                skill1Button.querySelector('p').textContent = "15-27 урона каждые 5.6 сек";
                skill1Button.querySelector('.cooldown').textContent = "Перезарядка: 10 сек";
                
                skill2Button.querySelector('h4').textContent = "Молоток";
                skill2Button.querySelector('p').textContent = "34 урона + парирование (13 сек)";
                skill2Button.querySelector('.cooldown').textContent = "Перезарядка: 8 сек";
                
                skill3Button.querySelector('h4').textContent = "Удар ногой";
                skill3Button.querySelector('p').textContent = "50 урона (20 сек)";
                skill3Button.querySelector('.cooldown').textContent = "Перезарядка: 12 сек";
            }
        }
        
        // Обработка клика
        function handleClick() {
            // Добавление монет с учетом бутылки
            const multiplier = bottleActive ? 2.2 : 1;
            const coinsToAdd = Math.floor(coinsPerClick * multiplier);
            coins += coinsToAdd;
            
            // Создание эффекта монеты
            createCoinEffect(coinsToAdd);
            
            // Обновление интерфейса
            updateUI();
            
            // Сохранение игры
            saveGame();
        }
        
        // Создание эффекта монеты
        function createCoinEffect(amount) {
            const effect = document.createElement('div');
            effect.className = 'coin-effect';
            effect.textContent = `+${amount}`;
            
            // Позиционирование случайным образом в области клика
            const rect = coinDisplay.getBoundingClientRect();
            const x = Math.random() * rect.width * 0.6 + rect.width * 0.2;
            const y = Math.random() * rect.height * 0.6 + rect.height * 0.2;
            
            effect.style.left = `${x}px`;
            effect.style.top = `${y}px`;
            
            coinDisplay.appendChild(effect);
            
            // Удаление эффекта после завершения анимации
            setTimeout(() => {
                effect.remove();
            }, 1500);
        }
        
        // Активация бутылки 2.2X
        function activateBottle() {
            if (inventory.bottles > 0) {
                inventory.bottles--;
                bottleActive = true;
                bottleTimer = 30;
                
                updateUI();
                updateInventory();
                
                // Показываем сообщение
                addLogEntry("Вы активировали бутылку 2.2X! Скорость удвоена на 30 сек.", "player");
            }
        }
        
        // Активация бутылки гравитации
        function activateGravityBottle() {
            if (inventory.gravityBottles > 0) {
                inventory.gravityBottles--;
                
                // Эффект гравитации в бою
                addLogEntry("Активирована гравитационная бутылка! Бот получил 15 урона.", "player");
                botHealth = Math.max(0, botHealth - 15);
                updateUI();
                updateInventory();
                
                if (botHealth <= 0) {
                    const reward = 50 + Math.floor(Math.random() * 50);
                    coins += reward;
                    updateUI();
                    addLogEntry(`Вы победили бота и получили ${reward} монет!`, "player");
                    resetArena();
                }
            }
        }
        
        // Активация бутылки глюцинации
        function activateGlitchBottle() {
            if (inventory.glitchBottles > 0) {
                inventory.glitchBottles--;
                
                addLogEntry("Активирована бутылка глюцинации! Бот дезориентирован.", "player");
                
                // Эффект глюков для бота
                botFrozen = true;
                if (botFrozenTimer) clearTimeout(botFrozenTimer);
                botFrozenTimer = setTimeout(() => {
                    botFrozen = false;
                    addLogEntry("Бот пришел в себя и снова может атаковать!", "bot");
                }, 5000);
                
                updateUI();
                updateInventory();
            }
        }
        
        // Покупка улучшений
        function buyUpgrade(upgradeId, cost, effect) {
            if (coins >= cost) {
                coins -= cost;
                effect();
                upgrades[upgradeId]++;
                updateUI();
                
                // Эффект покупки
                createCoinEffect(-cost);
                
                // Сохранение игры
                saveGame();
            } else {
                alert('Недостаточно Zhalker Coins!');
            }
        }
        
        // Покупка класса "Нуб"
        noobClass.addEventListener('click', () => {
            if (inventory.classes.includes("Нуб")) {
                alert('У вас уже есть этот класс!');
                return;
            }
            
            if (coins >= 500) {
                coins -= 500;
                inventory.classes.push("Нуб");
                
                // Если это первый класс, делаем его активным
                if (!playerClass) {
                    playerClass = "Нуб";
                }
                
                updateUI();
                updateSkillsForClass();
                updateInventory();
                
                // Показываем сообщение
                addLogEntry("Вы купили класс 'Нуб'! Теперь вы можете сражаться на арене.", "player");
                
                // Сохранение игры
                saveGame();
            } else {
                alert('Недостаточно Zhalker Coins для покупки класса!');
            }
        });
        
        // Покупка класса "Шедлеский"
        shedClass.addEventListener('click', () => {
            if (inventory.classes.includes("Шедлеский")) {
                alert('У вас уже есть этот класс!');
                return;
            }
            
            if (coins >= 800) {
                coins -= 800;
                inventory.classes.push("Шедлеский");
                
                // Если это первый класс, делаем его активным
                if (!playerClass) {
                    playerClass = "Шедлеский";
                }
                
                updateUI();
                updateSkillsForClass();
                updateInventory();
                
                // Показываем сообщение
                addLogEntry("Вы купили класс 'Шедлеский'! Теперь вы можете сражаться на арене.", "player");
                
                // Сохранение игры
                saveGame();
            } else {
                alert('Недостаточно Zhalker Coins для покупки класса!');
            }
        });
        
        // Покупка класса "Билдер"
        builderClass.addEventListener('click', () => {
            if (inventory.classes.includes("Билдер")) {
                alert('У вас уже есть этот класс!');
                return;
            }
            
            if (coins >= 150) {
                coins -= 150;
                inventory.classes.push("Билдер");
                
                // Если это первый класс, делаем его активным
                if (!playerClass) {
                    playerClass = "Билдер";
                }
                
                updateUI();
                updateSkillsForClass();
                updateInventory();
                
                // Показываем сообщение
                addLogEntry("Вы купили класс 'Билдер'! Теперь вы можете строить турели.", "player");
                
                // Сохранение игры
                saveGame();
            } else {
                alert('Недостаточно Zhalker Coins для покупки класса!');
            }
        });
        
        // Покупка бутылки 2.2X
        bottleUpgrade.addEventListener('click', () => {
            if (coins >= 100) {
                coins -= 100;
                inventory.bottles++;
                updateUI();
                updateInventory();
                
                // Эффект покупки
                createCoinEffect(-100);
                addLogEntry("Вы купили бутылку 2.2X! Используйте её в инвентаре.", "player");
                
                // Сохранение игры
                saveGame();
            } else {
                alert('Недостаточно Zhalker Coins для покупки бутылки!');
            }
        });
        
        // Создание сохранения игры
        function createSave() {
            const gameState = getGameState();
            
            // Генерируем случайное время жизни от 15 до 25 секунд
            const expirySeconds = Math.floor(Math.random() * 11) + 15; // 15-25 секунд
            const expiryTime = Date.now() + (expirySeconds * 1000);
            
            // Добавляем время истечения в состояние
            gameState.expiry = expiryTime;
            
            // Кодируем состояние игры в base64
            const saveString = btoa(JSON.stringify(gameState));
            
            // Формируем ссылку сохранения
            const saveLink = `${window.location.origin}${window.location.pathname}?save=${saveString}`;
            
            // Показываем ссылку сохранения
            saveLinkInput.style.display = 'block';
            saveLinkInput.value = saveLink;
            saveLinkInput.select();
            
            // Устанавливаем таймер
            saveExpiryTime = expiryTime;
            updateSaveTimer();
            
            // Устанавливаем таймаут для очистки ссылки
            if (saveTimeout) clearTimeout(saveTimeout);
            saveTimeout = setTimeout(() => {
                saveLinkInput.value = "";
                saveTimerElement.textContent = "Ссылка больше не действительна!";
                saveTimerElement.style.color = "#ff0000";
                saveExpiryTime = null;
            }, expirySeconds * 1000);
            
            // Показываем сообщение
            alert(`Сохранение создано! Скопируйте ссылку чтобы сохранить прогресс. Ссылка действительна ${expirySeconds} секунд.`);
        }
        
        // Получение состояния игры
        function getGameState() {
            return {
                coins: coins,
                coinsPerClick: coinsPerClick,
                coinsPerSecond: coinsPerSecond,
                upgrades: upgrades,
                inventory: inventory,
                playerClass: playerClass,
                playerHealth: playerHealth,
                botHealth: botHealth,
                activatedPromos: activatedPromos
            };
        }
        
        // Загрузка сохранения игры из данных
        function loadSaveFromData(saveData) {
            try {
                // Декодируем сохранение
                const decodedSave = atob(saveData);
                const gameState = JSON.parse(decodedSave);
                
                // Проверяем срок действия
                if (gameState.expiry && gameState.expiry < Date.now()) {
                    alert('Срок действия сохранения истек! Создайте новое сохранение.');
                    return false;
                }
                
                // Применяем сохранение
                coins = gameState.coins || 0;
                coinsPerClick = gameState.coinsPerClick || 1;
                coinsPerSecond = gameState.coinsPerSecond || 0;
                upgrades = gameState.upgrades || { upgrade1: 0, upgrade2: 0, upgrade3: 0, bottleUpgrade: 0 };
                inventory = gameState.inventory || { classes: [], bottles: 0, gravityBottles: 0, glitchBottles: 0 };
                playerClass = gameState.playerClass || null;
                playerHealth = gameState.playerHealth || 100;
                botHealth = gameState.botHealth || 100;
                activatedPromos = gameState.activatedPromos || [];
                
                // Обновляем интерфейс
                updateUI();
                updateSkillsForClass();
                updateInventory();
                
                return true;
            } catch (error) {
                console.error('Ошибка загрузки сохранения:', error);
                alert('Ошибка загрузки сохранения. Возможно, файл поврежден.');
                return false;
            }
        }
        
        // Загрузка сохранения игры
        function loadSave() {
            const saveLink = prompt('Вставьте ссылку сохранения:');
            if (!saveLink) return;
            
            try {
                // Извлекаем параметр сохранения из ссылки
                const url = new URL(saveLink);
                const saveData = url.searchParams.get('save');
                
                if (!saveData) {
                    throw new Error('Неверная ссылка сохранения');
                }
                
                // Загружаем сохранение
                if (loadSaveFromData(saveData)) {
                    alert('Сохранение успешно загружено!');
                    
                    // Сохранение в localStorage
                    saveGame();
                }
            } catch (error) {
                alert(`Ошибка загрузки сохранения: ${error.message}`);
                console.error('Ошибка загрузки сохранения:', error);
            }
        }
        
        // Загрузка локального сохранения
        function loadLocalSave() {
            const saveData = localStorage.getItem('zhalkerSave');
            if (saveData) {
                try {
                    const gameState = JSON.parse(saveData);
                    
                    // Применяем сохранение
                    coins = gameState.coins || 0;
                    coinsPerClick = gameState.coinsPerClick || 1;
                    coinsPerSecond = gameState.coinsPerSecond || 0;
                    upgrades = gameState.upgrades || { upgrade1: 0, upgrade2: 0, upgrade3: 0, bottleUpgrade: 0 };
                    inventory = gameState.inventory || { classes: [], bottles: 0, gravityBottles: 0, glitchBottles: 0 };
                    playerClass = gameState.playerClass || null;
                    playerHealth = gameState.playerHealth || 100;
                    botHealth = gameState.botHealth || 100;
                    activatedPromos = gameState.activatedPromos || [];
                    
                    // Обновляем интерфейс
                    updateUI();
                    updateSkillsForClass();
                    updateInventory();
                } catch (error) {
                    console.error('Ошибка загрузки сохранения:', error);
                }
            }
        }
        
        // Сохранение игры
        function saveGame() {
            const gameState = getGameState();
            
            // Сохранение в localStorage
            localStorage.setItem('zhalkerSave', JSON.stringify(gameState));
        }
        
        // Активация промокода
        function activatePromo() {
            const promoCode = promoInput.value.trim().toUpperCase();
            promoInput.value = "";
            
            if (promoCode === "HEX") {
                // Добавляем монеты
                coins += 250;
                
                // Добавляем классы
                if (!inventory.classes.includes("Пистолетчик")) {
                    inventory.classes.push("Пистолетчик");
                }
                if (!inventory.classes.includes("Билдер")) {
                    inventory.classes.push("Билдер");
                }
                
                // Добавляем бутылки
                inventory.gravityBottles++;
                inventory.glitchBottles++;
                inventory.bottles++;
                
                // Показываем сообщение
                promoMessage.innerHTML = `
                    Промокод HEX активирован!<br>
                    Получено: <span style="color:#ffcc00">250 монет</span>, 
                    <span style="color:#55aaff">класс Пистолетчик</span>,
                    <span style="color:#cd853f">класс Билдер</span>,
                    <span style="color:#55aaff">1 бутылка гравитации</span> и 
                    <span style="color:#ff55ff">1 бутылка глюцинации</span>,
                    <span style="color:#ffcc00">1 бутылка 2.2X</span>!
                `;
                promoMessage.style.color = "#55ff55";
                
                // Эффекты
                createCoinEffect(250);
                
                // Обновляем интерфейс
                updateUI();
                updateInventory();
                
                // Сохранение игры
                saveGame();
            }
            else if (promoCode === "2008") {
                // Добавляем монеты
                coins += 250;
                
                // Добавляем бутылки
                inventory.gravityBottles++;
                inventory.glitchBottles++;
                
                // Добавляем секретный класс
                if (!inventory.classes.includes("Bomber")) {
                    inventory.classes.push("Bomber");
                    addLogEntry("Вы получили секретный класс 'Bomber'!", "player");
                }
                
                // Показываем сообщение
                promoMessage.innerHTML = `
                    Промокод активирован!<br>
                    Получено: <span style="color:#ffcc00">250 монет</span>, 
                    <span style="color:#55aaff">1 бутылка гравитации</span> и 
                    <span style="color:#ff55ff">1 бутылка глюцинации</span>!
                `;
                promoMessage.style.color = "#55ff55";
                
                // Эффекты
                createCoinEffect(250);
                
                // Обновляем интерфейс
                updateUI();
                updateInventory();
                
                // Сохранение игры
                saveGame();
            }
            else if (promoCode === "HELLO") {
                // Добавляем монеты
                coins += 100;
                
                // Даем бонус "Нуба", если его еще нет
                if (!inventory.classes.includes("Нуб")) {
                    inventory.classes.push("Нуб");
                    promoMessage.innerHTML = "Промокод активирован! Получено: <span style='color:#ffcc00'>100 монет</span> и класс <span style='color:#55ff55'>Нуб</span>!";
                } else {
                    promoMessage.innerHTML = "Промокод активирован! Получено: <span style='color:#ffcc00'>100 монет</span>!";
                }
                
                // Эффекты
                createCoinEffect(100);
                promoMessage.style.color = "#55ff55";
                
                // Обновляем интерфейс
                updateUI();
                updateSkillsForClass();
                updateInventory();
                
                // Сохранение игры
                saveGame();
            } else {
                promoMessage.textContent = "Неверный промокод!";
                promoMessage.style.color = "#ff5555";
            }
        }
        
        // Логирование событий на арене
        function addLogEntry(text, type) {
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}-log`;
            entry.textContent = text;
            combatLog.appendChild(entry);
            
            // Прокрутка вниз
            combatLog.scrollTop = combatLog.scrollHeight;
        }
        
        // Бот атакует игрока
        function botAttack() {
            if (botFrozen) return;
            
            if (parryActive) {
                addLogEntry("Бот атаковал, но вы парировали удар!", "player");
                parryActive = false;
                return;
            }
            
            const damage = Math.floor(Math.random() * 15) + 10;
            playerHealth = Math.max(0, playerHealth - damage);
            updateUI();
            
            addLogEntry(`Бот атаковал вас и нанес ${damage} урона!`, "bot");
            
            if (playerHealth <= 0) {
                addLogEntry("Вы проиграли! Начните новый бой.", "bot");
                resetArena();
            }
        }
        
        // Атака игрока
        function playerAttack() {
            if (!playerClass) {
                alert("Сначала выберите класс в магазине!");
                return;
            }
            
            const damage = Math.floor(Math.random() * 5) + 8;
            botHealth = Math.max(0, botHealth - damage);
            updateUI();
            
            addLogEntry(`Вы атаковали бота и нанесли ${damage} урона!`, "player");
            
            if (botHealth <= 0) {
                const reward = 50 + Math.floor(Math.random() * 50);
                coins += reward;
                updateUI();
                addLogEntry(`Вы победили бота и получили ${reward} монет!`, "player");
                resetArena();
                return;
            }
            
            // Бот контратакует
            setTimeout(botAttack, 1000);
        }
        
        // Навыки класса "Нуб"
        function useHealthPotion() {
            if (skillCooldowns.skill1 > 0) {
                addLogEntry("Бутылка здоровья еще перезаряжается!", "player");
                return;
            }
            
            playerHealth = Math.min(100, playerHealth + 30);
            updateUI();
            addLogEntry("Вы использовали Бутылку здоровья и восстановили 30 HP!", "player");
            skillCooldowns.skill1 = 5.6;
            
            updateSkillCooldowns();
            
            // Бот атакует
            setTimeout(botAttack, 1000);
        }
        
        function useFlyingBurger() {
            if (skillCooldowns.skill2 > 0) {
                addLogEntry("Летающий бургер еще перезаряжается!", "player");
                return;
            }
            
            botHealth = Math.max(0, botHealth - 15);
            updateUI();
            
            addLogEntry("Вы использовали Летающий бургер! Бот получил 15 урона и заморожен на 4.59 секунд.", "player");
            
            // Замораживаем бота
            botFrozen = true;
            if (botFrozenTimer) clearTimeout(botFrozenTimer);
            botFrozenTimer = setTimeout(() => {
                botFrozen = false;
                addLogEntry("Бот оттаял и снова может атаковать!", "bot");
            }, 4590);
            
            skillCooldowns.skill2 = 4.59;
            updateSkillCooldowns();
            
            if (botHealth <= 0) {
                const reward = 50 + Math.floor(Math.random() * 50);
                coins += reward;
                updateUI();
                addLogEntry(`Вы победили бота и получили ${reward} монет!`, "player");
                resetArena();
            }
        }
        
        function useSword() {
            if (skillCooldowns.skill3 > 0) {
                addLogEntry("Меч еще перезаряжается!", "player");
                return;
            }
            
            const damage = Math.floor(Math.random() * 5) + 23;
            botHealth = Math.max(0, botHealth - damage);
            updateUI();
            
            addLogEntry(`Вы использовали Меч и нанесли ${damage} урона! Следующую атаку бота вы парируете.`, "player");
            
            parryActive = true;
            skillCooldowns.skill3 = 3;
            updateSkillCooldowns();
            
            if (botHealth <= 0) {
                const reward = 50 + Math.floor(Math.random() * 50);
                coins += reward;
                updateUI();
                addLogEntry(`Вы победили бота и получили ${reward} монет!`, "player");
                resetArena();
                return;
            }
            
            // Бот атакует (но будет парирован, если parryActive)
            setTimeout(botAttack, 1000);
        }
        
        // Навыки класса "Шедлеский"
        function useSwordShed() {
            if (skillCooldowns.skill1 > 0) {
                addLogEntry("Меч еще перезаряжается!", "player");
                return;
            }
            
            // Урон 15-23
            const damage = Math.floor(Math.random() * 9) + 15;
            botHealth = Math.max(0, botHealth - damage);
            updateUI();
            
            addLogEntry(`Вы использовали Меч и нанесли ${damage} урона!`, "player");
            
            skillCooldowns.skill1 = 1.99;
            updateSkillCooldowns();
            
            if (botHealth <= 0) {
                const reward = 50 + Math.floor(Math.random() * 50);
                coins += reward;
                updateUI();
                addLogEntry(`Вы победили бота и получили ${reward} монет!`, "player");
                resetArena();
                return;
            }
            
            setTimeout(botAttack, 1000);
        }
        
        function useChickenHeal() {
            if (skillCooldowns.skill2 > 0) {
                addLogEntry("Курочка еще перезаряжается!", "player");
                return;
            }
            
            // Лечение 19-29 HP
            const heal = Math.floor(Math.random() * 11) + 19;
            playerHealth = Math.min(100, playerHealth + heal);
            updateUI();
            
            addLogEntry(`Вы использовали Курочку и восстановили ${heal} HP!`, "player");
            skillCooldowns.skill2 = 4;
            updateSkillCooldowns();
            
            setTimeout(botAttack, 1000);
        }
        
        // Навыки класса "Bomber"
        function useFlyingExplosion() {
            if (skillCooldowns.skill1 > 0) {
                addLogEntry("Летающий взрыв еще перезаряжается!", "player");
                return;
            }
            
            addLogEntry("Вы активировали Летающий взрыв! Бомбы летят к врагу.", "player");
            
            // Запускаем 5 бомб
            let totalDamage = 0;
            for (let i = 0; i < 5; i++) {
                const damage = (Math.random() > 0.5 ? 3 : 4.4);
                totalDamage += damage;
                botHealth = Math.max(0, botHealth - damage);
            }
            
            updateUI();
            addLogEntry(`5 бомб нанесли ${totalDamage.toFixed(1)} урона боту!`, "player");
            
            skillCooldowns.skill1 = 10;
            updateSkillCooldowns();
            
            if (botHealth <= 0) {
                const reward = 50 + Math.floor(Math.random() * 50);
                coins += reward;
                updateUI();
                addLogEntry(`Вы победили бота и получили ${reward} монет!`, "player");
                resetArena();
                return;
            }
            
            setTimeout(botAttack, 1000);
        }
        
        function useGravityBomb() {
            if (skillCooldowns.skill2 > 0) {
                addLogEntry("Гравитационная бомба еще перезаряжается!", "player");
                return;
            }
            
            const damage = 15;
            botHealth = Math.max(0, botHealth - damage);
            updateUI();
            
            addLogEntry(`Вы использовали Гравитационную бомбу и нанесли ${damage} урона!`, "player");
            skillCooldowns.skill2 = 8;
            updateSkillCooldowns();
            
            if (botHealth <= 0) {
                const reward = 50 + Math.floor(Math.random() * 50);
                coins += reward;
                updateUI();
                addLogEntry(`Вы победили бота и получили ${reward} монет!`, "player");
                resetArena();
                return;
            }
            
            setTimeout(botAttack, 1000);
        }
        
        function useGlitchMine() {
            if (skillCooldowns.skill3 > 0) {
                addLogEntry("Глючная мина еще перезаряжается!", "player");
                return;
            }
            
            addLogEntry("Вы использовали Глючную мину! Бот дезориентирован.", "player");
            
            // Эффект глюков для бота
            botFrozen = true;
            if (botFrozenTimer) clearTimeout(botFrozenTimer);
            botFrozenTimer = setTimeout(() => {
                botFrozen = false;
                addLogEntry("Бот пришел в себя и снова может атаковать!", "bot");
            }, 5000);
            
            skillCooldowns.skill3 = 12;
            updateSkillCooldowns();
            
            setTimeout(botAttack, 1000);
        }
        
        // Навыки класса "Пистолетчик"
        function usePistol() {
            if (skillCooldowns.skill1 > 0) {
                addLogEntry("Пистолет перезаряжается!", "player");
                return;
            }

            // Базовый урон
            let damage = Math.floor(Math.random() * 15) + 20;
            
            // Шанс 15% на усиление/ослабление урона
            if (Math.random() < 0.15) {
                const multiplier = Math.random() > 0.5 ? 1.15 : 0.85;
                damage = Math.round(damage * multiplier);
                addLogEntry(`Сработал эффект джэкпота! Урон: ${damage}`, "player");
            }
            
            botHealth = Math.max(0, botHealth - damage);
            updateUI();
            
            addLogEntry(`Вы выстрелили из пистолета и нанесли ${damage} урона!`, "player");
            
            skillCooldowns.skill1 = 4;
            updateSkillCooldowns();
            
            if (botHealth <= 0) {
                const reward = 50 + Math.floor(Math.random() * 50);
                coins += reward;
                updateUI();
                addLogEntry(`Вы победили бота и получили ${reward} монет!`, "player");
                resetArena();
                return;
            }
            
            setTimeout(botAttack, 1000);
        }

        function useHat() {
            if (skillCooldowns.skill2 > 0) {
                addLogEntry("Шляпа еще перезаряжается!", "player");
                return;
            }
            
            addLogEntry("Вы поправили шляпу! Пистолет защищен от потери.", "player");
            
            // Активируем защиту
            hatActive = true;
            if (hatTimer) clearTimeout(hatTimer);
            hatTimer = setTimeout(() => {
                hatActive = false;
                addLogEntry("Защита шляпы закончилась!", "player");
            }, 10000);
            
            skillCooldowns.skill2 = 15;
            updateSkillCooldowns();
            
            setTimeout(botAttack, 1000);
        }

        // Навыки класса "Билдер"
        function useTurret() {
            if (skillCooldowns.skill1 > 0) {
                addLogEntry("Турель перезаряжается!", "player");
                return;
            }
            
            const damage = Math.floor(Math.random() * 13) + 15;
            botHealth = Math.max(0, botHealth - damage);
            updateUI();
            
            addLogEntry(`Турель выстрелила и нанесла ${damage} урона!`, "player");
            
            // Автоматический урон каждые 5.6 секунд
            if (turretInterval) clearInterval(turretInterval);
            turretInterval = setInterval(() => {
                if (botHealth <= 0) return;
                const autoDamage = Math.floor(Math.random() * 13) + 15;
                botHealth = Math.max(0, botHealth - autoDamage);
                updateUI();
                addLogEntry(`Турель автоматически нанесла ${autoDamage} урона!`, "player");
                
                if (botHealth <= 0) {
                    clearInterval(turretInterval);
                    const reward = 50 + Math.floor(Math.random() * 50);
                    coins += reward;
                    updateUI();
                    addLogEntry(`Вы победили бота и получили ${reward} монет!`, "player");
                    resetArena();
                }
            }, 5600);
            
            skillCooldowns.skill1 = 10;
            updateSkillCooldowns();
            
            setTimeout(botAttack, 1000);
        }

        function useHammer() {
            if (skillCooldowns.skill2 > 0) {
                addLogEntry("Молоток перезаряжается!", "player");
                return;
            }
            
            const damage = 34;
            botHealth = Math.max(0, botHealth - damage);
            updateUI();
            
            addLogEntry(`Вы ударили молотком и нанесли ${damage} урона! Парирование активно 13 сек.`, "player");
            
            // Активируем парирование
            parryActive = true;
            if (parryTimer) clearTimeout(parryTimer);
            parryTimer = setTimeout(() => {
                parryActive = false;
                addLogEntry("Парирование закончилось!", "player");
            }, 13000);
            
            skillCooldowns.skill2 = 8;
            updateSkillCooldowns();
            
            if (botHealth <= 0) {
                const reward = 50 + Math.floor(Math.random() * 50);
                coins += reward;
                updateUI();
                addLogEntry(`Вы победили бота и получили ${reward} монет!`, "player");
                resetArena();
                return;
            }
            
            setTimeout(botAttack, 1000);
        }

        function useKick() {
            if (skillCooldowns.skill3 > 0) {
                addLogEntry("Удар ногой перезаряжается!", "player");
                return;
            }
            
            const damage = 50;
            botHealth = Math.max(0, botHealth - damage);
            updateUI();
            
            addLogEntry(`Вы ударили ногой и нанесли ${damage} урона!`, "player");
            
            skillCooldowns.skill3 = 12;
            updateSkillCooldowns();
            
            if (botHealth <= 0) {
                const reward = 50 + Math.floor(Math.random() * 50);
                coins += reward;
                updateUI();
                addLogEntry(`Вы победили бота и получили ${reward} монет!`, "player");
                resetArena();
                return;
            }
            
            setTimeout(botAttack, 1000);
        }
        
        // Обновление отображения перезарядки навыков
        function updateSkillCooldowns() {
            document.querySelectorAll('.cooldown').forEach(el => {
                el.textContent = "Готово";
                el.style.color = "#00ff00";
            });
            
            for (const skill in skillCooldowns) {
                if (skillCooldowns[skill] > 0) {
                    const cooldownElement = document.getElementById(skill).querySelector('.cooldown');
                    cooldownElement.textContent = `Перезарядка: ${skillCooldowns[skill].toFixed(1)} сек`;
                    cooldownElement.style.color = "#ff9900";
                }
            }
        }
        
        // Сброс арены
        function resetArena() {
            playerHealth = 100;
            botHealth = 100;
            botFrozen = false;
            parryActive = false;
            skillCooldowns = { skill1: 0, skill2: 0, skill3: 0 };
            
            if (botFrozenTimer) {
                clearTimeout(botFrozenTimer);
                botFrozenTimer = null;
            }
            
            // Сброс новых таймеров
            if (hatTimer) {
                clearTimeout(hatTimer);
                hatTimer = null;
            }
            if (turretInterval) {
                clearInterval(turretInterval);
                turretInterval = null;
            }
            if (parryTimer) {
                clearTimeout(parryTimer);
                parryTimer = null;
            }
            
            hatActive = false;
            
            updateUI();
            updateSkillCooldowns();
            addLogEntry("Арена сброшена. Начните новый бой!", "player");
        }
        
        // Инициализация улучшений
        document.getElementById('upgrade1').addEventListener('click', () => {
            buyUpgrade('upgrade1', 10, () => {
                coinsPerClick += 1;
            });
        });
        
        document.getElementById('upgrade2').addEventListener('click', () => {
            buyUpgrade('upgrade2', 50, () => {
                coinsPerSecond += 1;
            });
        });
        
        document.getElementById('upgrade3').addEventListener('click', () => {
            buyUpgrade('upgrade3', 200, () => {
                coinsPerClick += 5;
            });
        });
        
        // Обработчики кнопок арены
        attackButton.addEventListener('click', playerAttack);
        
        // Универсальные обработчики для навыков
        skill1Button.addEventListener('click', function() {
            if (playerClass === "Нуб") {
                useHealthPotion();
            } else if (playerClass === "Шедлеский") {
                useSwordShed();
            } else if (playerClass === "Bomber") {
                useFlyingExplosion();
            } else if (playerClass === "Пистолетчик") {
                usePistol();
            } else if (playerClass === "Билдер") {
                useTurret();
            }
        });
        
        skill2Button.addEventListener('click', function() {
            if (playerClass === "Нуб") {
                useFlyingBurger();
            } else if (playerClass === "Шедлеский") {
                useChickenHeal();
            } else if (playerClass === "Bomber") {
                useGravityBomb();
            } else if (playerClass === "Пистолетчик") {
                useHat();
            } else if (playerClass === "Билдер") {
                useHammer();
            }
        });
        
        skill3Button.addEventListener('click', function() {
            if (playerClass === "Нуб") {
                useSword();
            } else if (playerClass === "Bomber") {
                useGlitchMine();
            } else if (playerClass === "Билдер") {
                useKick();
            }
        });
        
        // Обработчики кнопок сохранения
        saveGameButton.addEventListener('click', createSave);
        loadGameButton.addEventListener('click', loadSave);
        
        // Обработчик активации промокода
        activatePromoButton.addEventListener('click', activatePromo);
        promoInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                activatePromo();
            }
        });
        
        // Назначение обработчика клика
        clicker.addEventListener('click', handleClick);
        
        // Инициализация игры
        window.addEventListener('load', initGame);
    </script>
</body>
</html>
